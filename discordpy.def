Bootstrap: docker
From: ubuntu:24.04
Stage: build

# This is a Singularity definition file for building a container for Discord.py development.
# The REQUIREMENTS.txt file should be placed in the same directory as this definition file.

# To build the container, run:
# singularity build discordpy.sif discordpy.def

# Files to move into the container
%files
    REQUIREMENTS.txt /build/REQUIREMENTS.txt

# Will be executed after the container is built
%post
    # Update repos
    # and install some necessary packages
    apt-get -y update
    apt-get -y install \
        wget\
        git

    # Install minconda
    mkdir -p /build/miniconda3
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O /build/miniconda3/miniconda.sh
    bash /build/miniconda3/miniconda.sh -b -u -p /build/miniconda3
    rm /build/miniconda3/miniconda.sh

    # Activate conda environment
    . /build/miniconda3/bin/activate

    # Initialize conda
    conda init --all
    conda install pip

    # Install all the requirements
    pip install -r /build/REQUIREMENTS.txt

    conda update conda
    conda list

# Set up environment variables
%environment
    PATH="/build/miniconda3/bin:$PATH"

%labels
    Author: Wright State CS Dev Team
    Date: May 2025